{"version":3,"sources":["webpack:///./src/views/Planning.vue?c62c","webpack:///src/views/Planning.vue","webpack:///./src/views/Planning.vue?f4f6","webpack:///./src/views/Planning.vue","webpack:///./src/views/Planning.vue?7a77"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","_f","info","bill","categories","length","_l","date","class","isActive","on","$event","showCategories","name","cat","key","id","months","value","title","spend","limit","_e","directives","rawName","expression","modifiers","progressColor","style","width","attrs","staticRenderFns","component"],"mappings":"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","file":"js/chunk-dd241c54.d7edd3d3.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"planning\"},[_c('div',{staticClass:\"page-title\"},[_c('h3',[_vm._v(_vm._s(_vm._f(\"localize\")('Menu_Planning')))]),_c('h4',[_vm._v(_vm._s(_vm._f(\"currency\")(_vm.info.bill,'RUB')))])]),(_vm.loading)?_c('loader'):(!_vm.categories.length)?_c('p',{staticClass:\"center\"},[_vm._v(\" \"+_vm._s(_vm._f(\"localize\")('Categories_NoCat'))+\". \"),_c('router-link',{attrs:{\"to\":\"/categories\"}},[_vm._v(_vm._s(_vm._f(\"localize\")('AddFirst')))])],1):_c('section',[_c('ul',{staticClass:\"collapsible\"},_vm._l((_vm.dateSections),function(date){return _c('li',{class:{'active': date.isActive}},[_c('div',{staticClass:\"collapsible-header\",on:{\"click\":function($event){return _vm.showCategories(date)}}},[_c('i',{staticClass:\"material-icons\"},[_vm._v(\"date_range\")]),_vm._v(\" \"+_vm._s(date.name)+\" \")]),_c('div',{staticClass:\"collapsible-body\"},_vm._l((_vm.categories),function(cat){return _c('div',{key:cat.id},[(cat.months[date.value])?_c('p',[_c('strong',[_vm._v(_vm._s(cat.title)+\":\")]),_vm._v(\" \"+_vm._s(_vm._f(\"currency\")(cat.months[date.value].spend))+\" \"+_vm._s(_vm._f(\"localize\")('Of'))+\" \"+_vm._s(_vm._f(\"currency\")(cat.limit))+\" \")]):_vm._e(),(cat.months[date.value])?_c('div',{directives:[{name:\"tooltip\",rawName:\"v-tooltip.noloc\",value:(cat.months[date.value].tooltip),expression:\"cat.months[date.value].tooltip\",modifiers:{\"noloc\":true}}],staticClass:\"progress\"},[_c('div',{staticClass:\"determinate\",class:[cat.months[date.value].progressColor],style:({width: ((cat.months[date.value].progressPercent) + \"%\")})})]):_vm._e()])}),0)])}),0)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"planning\">\r\n    <div class=\"page-title\">\r\n      <h3>{{'Menu_Planning'|localize}}</h3>\r\n      <h4>{{info.bill | currency('RUB')}}</h4>\r\n    </div>\r\n    <loader v-if=\"loading\"/>\r\n    <p class=\"center\" v-else-if=\"!categories.length\">\r\n      {{'Categories_NoCat'|localize}}.\r\n      <router-link to=\"/categories\">{{'AddFirst'|localize}}</router-link>\r\n    </p>\r\n    <section v-else>\r\n      <ul class=\"collapsible\">\r\n        <li :class=\"{'active': date.isActive}\" v-for=\"date of dateSections\">\r\n          <div class=\"collapsible-header\" @click=\"showCategories(date)\"><i class=\"material-icons\">date_range</i>\r\n            {{date.name}}\r\n          </div>\r\n          <div class=\"collapsible-body\">\r\n            <div v-for=\"cat of categories\" :key=\"cat.id\">\r\n              <p v-if=\"cat.months[date.value]\">\r\n                <strong>{{cat.title}}:</strong>\r\n                {{cat.months[date.value].spend|currency}} {{'Of'|localize}} {{cat.limit|currency}}\r\n              </p>\r\n              <div v-if=\"cat.months[date.value]\" class=\"progress\" v-tooltip.noloc=\"cat.months[date.value].tooltip\">\r\n                <div class=\"determinate\"\r\n                     :class=\"[cat.months[date.value].progressColor]\"\r\n                     :style=\"{width: `${cat.months[date.value].progressPercent}%`}\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n\r\n\r\n    </section>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {mapGetters} from 'vuex';\r\n  import currencyFilter from '@/filters/currency.filter';\r\n  import localizeFilter from '@/filters/localize.filter';\r\n  import {getDateString, sortData} from '@/helpers';\r\n  import _ from 'lodash';\r\n\r\n  export default {\r\n    name: \"Planning\",\r\n    metaInfo() {\r\n      return {title: this.$title('Menu_Planning')}\r\n    },\r\n    data() {\r\n      return {\r\n        loading: true,\r\n        categories: [],\r\n        dateSections: [],\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapGetters(['info'])\r\n    },\r\n    methods: {\r\n      showCategories(currentDate) {\r\n        this.dateSections.map(date => {\r\n          if (date.value === currentDate.value && currentDate.isActive) {\r\n            date.isActive = false;\r\n          } else {\r\n            date.isActive = date.value === currentDate.value;\r\n          }\r\n        })\r\n      }\r\n    },\r\n    async mounted() {\r\n      const records = sortData(await this.$store.dispatch('fetchRecords'), {\r\n        key: 'date',\r\n        type: 'date',\r\n        sort: 'up-down'\r\n      });\r\n      const categories = await this.$store.dispatch('fetchCategories');\r\n      if (records.length > 0) {\r\n        this.dateSections = _.uniq(records.map(rec => {\r\n          return rec.dateSection;\r\n        })).filter(s => s).map(sec => {\r\n          return {\r\n            name: getDateString(sec),\r\n            value: sec,\r\n            isActive: false,\r\n          }\r\n        });\r\n        this.dateSections[0]['isActive'] = true;\r\n\r\n      }\r\n      if (categories.length > 0) {\r\n        this.categories = categories.map(cat => {\r\n          let months = {};\r\n          if (cat.months) {\r\n            cat.months.map((month) => {\r\n              const spend = records\r\n                  .filter(r => r.categoryId === cat.id)\r\n                  .filter(r => r.dateSection === month)\r\n                  .filter(r => r.type === 'outcome')\r\n                  .reduce((sum, record) => {\r\n                    return sum += +record.amount\r\n                  }, 0);\r\n              const percent = 100 * spend / cat.limit;\r\n              const progressPercent = percent > 100 ? 100 : percent;\r\n              const progressColor = percent < 60\r\n                  ? 'green'\r\n                  : percent < 100\r\n                      ? 'yellow'\r\n                      : 'red';\r\n              const tooltipValue = cat.limit - spend;\r\n              const tooltip = `${tooltipValue < 0 ? localizeFilter('MoreThan') : localizeFilter('Stayed')} ${currencyFilter(Math.abs(tooltipValue))}`;\r\n              months[month] = {\r\n                spend,\r\n                progressPercent,\r\n                progressColor,\r\n                tooltip\r\n              }\r\n\r\n            });\r\n          }\r\n          return {\r\n            ...cat,\r\n            months,\r\n          }\r\n        });\r\n      }\r\n      this.loading = false;\r\n    }\r\n  }\r\n\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n  .planning {\r\n    & .collapsible {\r\n      & .active .collapsible-body {\r\n        display: block;\r\n      }\r\n    }\r\n\r\n    & .collapsible-body {\r\n      padding: 10px 60px;\r\n    }\r\n  }\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Planning.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Planning.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Planning.vue?vue&type=template&id=b502b6ec&\"\nimport script from \"./Planning.vue?vue&type=script&lang=js&\"\nexport * from \"./Planning.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Planning.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Planning.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Planning.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}